var ia=Object.defineProperty;var na=(e,i,t)=>i in e?ia(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var R=(e,i,t)=>(na(e,typeof i!="symbol"?i+"":i,t),t);import{s as aa,x as ra,i as oa,n as ri,r as la,o as sa,y as fa,e as ha}from"../chunks/scheduler.B8wtCbz7.js";import{S as ca,i as _a,e as Y,s as q,t as G,c as X,a as ae,d as M,f as J,y as da,b as K,o as Ie,g as V,h as Z,z as ke,j as _e}from"../chunks/index.Dt0ReVwJ.js";class ua{constructor(i,t){R(this,"world");R(this,"canvas");R(this,"ctx");R(this,"cameraX",0);R(this,"cameraY",0);R(this,"cameraZoom",32);R(this,"cameraMinZoom",4);R(this,"cameraMaxZoom",64);this.world=i,this.canvas=t;const n=this.canvas.getContext("2d");if(!n)throw new Error("This browser or machine does not support canvas 2d.");this.ctx=n}cameraWidth(){return this.canvas.width/this.cameraZoom}cameraHeight(){return this.canvas.height/this.cameraZoom}cameraTranslate(i,t){this.cameraX-=i/this.cameraZoom,this.cameraY-=t/this.cameraZoom}cameraScale(i){const t=this.cameraX+this.cameraWidth()*.5,n=this.cameraY+this.cameraHeight()*.5;this.cameraZoom*=i,this.canvas.width/this.cameraZoom<this.cameraMinZoom&&(this.cameraZoom=this.canvas.width/this.cameraMinZoom),this.canvas.height/this.cameraZoom<this.cameraMinZoom&&(this.cameraZoom=this.canvas.height/this.cameraMinZoom),this.canvas.width/this.cameraZoom>this.cameraMaxZoom&&(this.cameraZoom=this.canvas.width/this.cameraMaxZoom),this.canvas.height/this.cameraZoom>this.cameraMaxZoom&&(this.cameraZoom=this.canvas.height/this.cameraMaxZoom);const a=this.cameraX+this.cameraWidth()*.5,r=this.cameraY+this.cameraHeight()*.5;return this.cameraX-=a-t,this.cameraY-=r-n,this.cameraZoom}cameraBounds(i=0){return{minX:Math.floor(this.cameraX-i),minY:Math.floor(this.cameraY-i),maxX:Math.ceil(this.cameraX+this.cameraWidth()+i),maxY:Math.ceil(this.cameraY+this.cameraHeight()+i)}}cameraPos(i,t){return{x:Math.floor(i/this.cameraZoom+this.cameraX),y:Math.floor(t/this.cameraZoom+this.cameraY)}}renderWorld(){this.ctx.imageSmoothingEnabled=!1,this.ctx.scale(this.cameraZoom,this.cameraZoom),this.ctx.translate(-this.cameraX,-this.cameraY);const i=this.cameraBounds(1);for(let t=i.minX;t<i.maxX;t++)for(let n=i.minY;n<i.maxY;n++)this.ctx.save(),this.ctx.translate(t,n),this.ctx.scale(1.01,1.01),this.world.getTile(t,n).render(this.ctx),this.ctx.restore();this.ctx.imageSmoothingEnabled=!0}render(){this.ctx.reset(),this.ctx.fillStyle="purple",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderWorld()}}/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */const ba=4,oi=0,li=1,wa=2;function Re(e){let i=e.length;for(;--i>=0;)e[i]=0}const ga=0,rn=1,pa=2,ma=3,xa=258,Xt=29,Ve=256,He=Ve+1+Xt,Ae=30,$t=19,on=2*He+1,de=15,mt=16,va=7,Gt=256,ln=16,sn=17,fn=18,It=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),st=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ka=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),hn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ya=512,re=new Array((He+2)*2);Re(re);const Oe=new Array(Ae*2);Re(Oe);const Pe=new Array(ya);Re(Pe);const Ye=new Array(xa-ma+1);Re(Ye);const Kt=new Array(Xt);Re(Kt);const ht=new Array(Ae);Re(ht);function xt(e,i,t,n,a){this.static_tree=e,this.extra_bits=i,this.extra_base=t,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let cn,_n,dn;function vt(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}const un=e=>e<256?Pe[e]:Pe[256+(e>>>7)],Xe=(e,i)=>{e.pending_buf[e.pending++]=i&255,e.pending_buf[e.pending++]=i>>>8&255},F=(e,i,t)=>{e.bi_valid>mt-t?(e.bi_buf|=i<<e.bi_valid&65535,Xe(e,e.bi_buf),e.bi_buf=i>>mt-e.bi_valid,e.bi_valid+=t-mt):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=t)},ee=(e,i,t)=>{F(e,t[i*2],t[i*2+1])},bn=(e,i)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--i>0);return t>>>1},Ea=e=>{e.bi_valid===16?(Xe(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},Aa=(e,i)=>{const t=i.dyn_tree,n=i.max_code,a=i.stat_desc.static_tree,r=i.stat_desc.has_stree,s=i.stat_desc.extra_bits,o=i.stat_desc.extra_base,h=i.stat_desc.max_length;let l,f,p,d,c,b,E=0;for(d=0;d<=de;d++)e.bl_count[d]=0;for(t[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<on;l++)f=e.heap[l],d=t[t[f*2+1]*2+1]+1,d>h&&(d=h,E++),t[f*2+1]=d,!(f>n)&&(e.bl_count[d]++,c=0,f>=o&&(c=s[f-o]),b=t[f*2],e.opt_len+=b*(d+c),r&&(e.static_len+=b*(a[f*2+1]+c)));if(E!==0){do{for(d=h-1;e.bl_count[d]===0;)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[h]--,E-=2}while(E>0);for(d=h;d!==0;d--)for(f=e.bl_count[d];f!==0;)p=e.heap[--l],!(p>n)&&(t[p*2+1]!==d&&(e.opt_len+=(d-t[p*2+1])*t[p*2],t[p*2+1]=d),f--)}},wn=(e,i,t)=>{const n=new Array(de+1);let a=0,r,s;for(r=1;r<=de;r++)a=a+t[r-1]<<1,n[r]=a;for(s=0;s<=i;s++){let o=e[s*2+1];o!==0&&(e[s*2]=bn(n[o]++,o))}},Sa=()=>{let e,i,t,n,a;const r=new Array(de+1);for(t=0,n=0;n<Xt-1;n++)for(Kt[n]=t,e=0;e<1<<It[n];e++)Ye[t++]=n;for(Ye[t-1]=n,a=0,n=0;n<16;n++)for(ht[n]=a,e=0;e<1<<st[n];e++)Pe[a++]=n;for(a>>=7;n<Ae;n++)for(ht[n]=a<<7,e=0;e<1<<st[n]-7;e++)Pe[256+a++]=n;for(i=0;i<=de;i++)r[i]=0;for(e=0;e<=143;)re[e*2+1]=8,e++,r[8]++;for(;e<=255;)re[e*2+1]=9,e++,r[9]++;for(;e<=279;)re[e*2+1]=7,e++,r[7]++;for(;e<=287;)re[e*2+1]=8,e++,r[8]++;for(wn(re,He+1,r),e=0;e<Ae;e++)Oe[e*2+1]=5,Oe[e*2]=bn(e,5);cn=new xt(re,It,Ve+1,He,de),_n=new xt(Oe,st,0,Ae,de),dn=new xt(new Array(0),ka,0,$t,va)},gn=e=>{let i;for(i=0;i<He;i++)e.dyn_ltree[i*2]=0;for(i=0;i<Ae;i++)e.dyn_dtree[i*2]=0;for(i=0;i<$t;i++)e.bl_tree[i*2]=0;e.dyn_ltree[Gt*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},pn=e=>{e.bi_valid>8?Xe(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},si=(e,i,t,n)=>{const a=i*2,r=t*2;return e[a]<e[r]||e[a]===e[r]&&n[i]<=n[t]},kt=(e,i,t)=>{const n=e.heap[t];let a=t<<1;for(;a<=e.heap_len&&(a<e.heap_len&&si(i,e.heap[a+1],e.heap[a],e.depth)&&a++,!si(i,n,e.heap[a],e.depth));)e.heap[t]=e.heap[a],t=a,a<<=1;e.heap[t]=n},fi=(e,i,t)=>{let n,a,r=0,s,o;if(e.sym_next!==0)do n=e.pending_buf[e.sym_buf+r++]&255,n+=(e.pending_buf[e.sym_buf+r++]&255)<<8,a=e.pending_buf[e.sym_buf+r++],n===0?ee(e,a,i):(s=Ye[a],ee(e,s+Ve+1,i),o=It[s],o!==0&&(a-=Kt[s],F(e,a,o)),n--,s=un(n),ee(e,s,t),o=st[s],o!==0&&(n-=ht[s],F(e,n,o)));while(r<e.sym_next);ee(e,Gt,i)},Mt=(e,i)=>{const t=i.dyn_tree,n=i.stat_desc.static_tree,a=i.stat_desc.has_stree,r=i.stat_desc.elems;let s,o,h=-1,l;for(e.heap_len=0,e.heap_max=on,s=0;s<r;s++)t[s*2]!==0?(e.heap[++e.heap_len]=h=s,e.depth[s]=0):t[s*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,t[l*2]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=n[l*2+1]);for(i.max_code=h,s=e.heap_len>>1;s>=1;s--)kt(e,t,s);l=r;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],kt(e,t,1),o=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=o,t[l*2]=t[s*2]+t[o*2],e.depth[l]=(e.depth[s]>=e.depth[o]?e.depth[s]:e.depth[o])+1,t[s*2+1]=t[o*2+1]=l,e.heap[1]=l++,kt(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],Aa(e,i),wn(t,h,e.bl_count)},hi=(e,i,t)=>{let n,a=-1,r,s=i[0*2+1],o=0,h=7,l=4;for(s===0&&(h=138,l=3),i[(t+1)*2+1]=65535,n=0;n<=t;n++)r=s,s=i[(n+1)*2+1],!(++o<h&&r===s)&&(o<l?e.bl_tree[r*2]+=o:r!==0?(r!==a&&e.bl_tree[r*2]++,e.bl_tree[ln*2]++):o<=10?e.bl_tree[sn*2]++:e.bl_tree[fn*2]++,o=0,a=r,s===0?(h=138,l=3):r===s?(h=6,l=3):(h=7,l=4))},ci=(e,i,t)=>{let n,a=-1,r,s=i[0*2+1],o=0,h=7,l=4;for(s===0&&(h=138,l=3),n=0;n<=t;n++)if(r=s,s=i[(n+1)*2+1],!(++o<h&&r===s)){if(o<l)do ee(e,r,e.bl_tree);while(--o!==0);else r!==0?(r!==a&&(ee(e,r,e.bl_tree),o--),ee(e,ln,e.bl_tree),F(e,o-3,2)):o<=10?(ee(e,sn,e.bl_tree),F(e,o-3,3)):(ee(e,fn,e.bl_tree),F(e,o-11,7));o=0,a=r,s===0?(h=138,l=3):r===s?(h=6,l=3):(h=7,l=4)}},Ta=e=>{let i;for(hi(e,e.dyn_ltree,e.l_desc.max_code),hi(e,e.dyn_dtree,e.d_desc.max_code),Mt(e,e.bl_desc),i=$t-1;i>=3&&e.bl_tree[hn[i]*2+1]===0;i--);return e.opt_len+=3*(i+1)+5+5+4,i},za=(e,i,t,n)=>{let a;for(F(e,i-257,5),F(e,t-1,5),F(e,n-4,4),a=0;a<n;a++)F(e,e.bl_tree[hn[a]*2+1],3);ci(e,e.dyn_ltree,i-1),ci(e,e.dyn_dtree,t-1)},Ra=e=>{let i=4093624447,t;for(t=0;t<=31;t++,i>>>=1)if(i&1&&e.dyn_ltree[t*2]!==0)return oi;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return li;for(t=32;t<Ve;t++)if(e.dyn_ltree[t*2]!==0)return li;return oi};let _i=!1;const Da=e=>{_i||(Sa(),_i=!0),e.l_desc=new vt(e.dyn_ltree,cn),e.d_desc=new vt(e.dyn_dtree,_n),e.bl_desc=new vt(e.bl_tree,dn),e.bi_buf=0,e.bi_valid=0,gn(e)},mn=(e,i,t,n)=>{F(e,(ga<<1)+(n?1:0),3),pn(e),Xe(e,t),Xe(e,~t),t&&e.pending_buf.set(e.window.subarray(i,i+t),e.pending),e.pending+=t},Za=e=>{F(e,rn<<1,3),ee(e,Gt,re),Ea(e)},Ca=(e,i,t,n)=>{let a,r,s=0;e.level>0?(e.strm.data_type===wa&&(e.strm.data_type=Ra(e)),Mt(e,e.l_desc),Mt(e,e.d_desc),s=Ta(e),a=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=a&&(a=r)):a=r=t+5,t+4<=a&&i!==-1?mn(e,i,t,n):e.strategy===ba||r===a?(F(e,(rn<<1)+(n?1:0),3),fi(e,re,Oe)):(F(e,(pa<<1)+(n?1:0),3),za(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),fi(e,e.dyn_ltree,e.dyn_dtree)),gn(e),n&&pn(e)},Ia=(e,i,t)=>(e.pending_buf[e.sym_buf+e.sym_next++]=i,e.pending_buf[e.sym_buf+e.sym_next++]=i>>8,e.pending_buf[e.sym_buf+e.sym_next++]=t,i===0?e.dyn_ltree[t*2]++:(e.matches++,i--,e.dyn_ltree[(Ye[t]+Ve+1)*2]++,e.dyn_dtree[un(i)*2]++),e.sym_next===e.sym_end);var Ma=Da,Na=mn,La=Ca,Ua=Ia,Oa=Za,Ba={_tr_init:Ma,_tr_stored_block:Na,_tr_flush_block:La,_tr_tally:Ua,_tr_align:Oa};const Fa=(e,i,t,n)=>{let a=e&65535|0,r=e>>>16&65535|0,s=0;for(;t!==0;){s=t>2e3?2e3:t,t-=s;do a=a+i[n++]|0,r=r+a|0;while(--s);a%=65521,r%=65521}return a|r<<16|0};var $e=Fa;const Ha=()=>{let e,i=[];for(var t=0;t<256;t++){e=t;for(var n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;i[t]=e}return i},Pa=new Uint32Array(Ha()),Ya=(e,i,t,n)=>{const a=Pa,r=n+t;e^=-1;for(let s=n;s<r;s++)e=e>>>8^a[(e^i[s])&255];return e^-1};var L=Ya,ge={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xe={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Xa,_tr_stored_block:Nt,_tr_flush_block:$a,_tr_tally:fe,_tr_align:Ga}=Ba,{Z_NO_FLUSH:he,Z_PARTIAL_FLUSH:Ka,Z_FULL_FLUSH:ja,Z_FINISH:j,Z_BLOCK:di,Z_OK:U,Z_STREAM_END:ui,Z_STREAM_ERROR:te,Z_DATA_ERROR:Wa,Z_BUF_ERROR:yt,Z_DEFAULT_COMPRESSION:Va,Z_FILTERED:qa,Z_HUFFMAN_ONLY:it,Z_RLE:Ja,Z_FIXED:Qa,Z_DEFAULT_STRATEGY:er,Z_UNKNOWN:tr,Z_DEFLATED:ut}=xe,ir=9,nr=15,ar=8,rr=29,or=256,Lt=or+1+rr,lr=30,sr=19,fr=2*Lt+1,hr=15,z=3,se=258,ie=se+z+1,cr=32,Te=42,jt=57,Ut=69,Ot=73,Bt=91,Ft=103,ue=113,Ne=666,B=1,De=2,pe=3,Ze=4,_r=3,be=(e,i)=>(e.msg=ge[i],i),bi=e=>e*2-(e>4?9:0),le=e=>{let i=e.length;for(;--i>=0;)e[i]=0},dr=e=>{let i,t,n,a=e.w_size;i=e.hash_size,n=i;do t=e.head[--n],e.head[n]=t>=a?t-a:0;while(--i);i=a,n=i;do t=e.prev[--n],e.prev[n]=t>=a?t-a:0;while(--i)};let ur=(e,i,t)=>(i<<e.hash_shift^t)&e.hash_mask,ce=ur;const P=e=>{const i=e.state;let t=i.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+t),e.next_out),e.next_out+=t,i.pending_out+=t,e.total_out+=t,e.avail_out-=t,i.pending-=t,i.pending===0&&(i.pending_out=0))},$=(e,i)=>{$a(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,i),e.block_start=e.strstart,P(e.strm)},D=(e,i)=>{e.pending_buf[e.pending++]=i},Me=(e,i)=>{e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=i&255},Ht=(e,i,t,n)=>{let a=e.avail_in;return a>n&&(a=n),a===0?0:(e.avail_in-=a,i.set(e.input.subarray(e.next_in,e.next_in+a),t),e.state.wrap===1?e.adler=$e(e.adler,i,a,t):e.state.wrap===2&&(e.adler=L(e.adler,i,a,t)),e.next_in+=a,e.total_in+=a,a)},xn=(e,i)=>{let t=e.max_chain_length,n=e.strstart,a,r,s=e.prev_length,o=e.nice_match;const h=e.strstart>e.w_size-ie?e.strstart-(e.w_size-ie):0,l=e.window,f=e.w_mask,p=e.prev,d=e.strstart+se;let c=l[n+s-1],b=l[n+s];e.prev_length>=e.good_match&&(t>>=2),o>e.lookahead&&(o=e.lookahead);do if(a=i,!(l[a+s]!==b||l[a+s-1]!==c||l[a]!==l[n]||l[++a]!==l[n+1])){n+=2,a++;do;while(l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&n<d);if(r=se-(d-n),n=d-se,r>s){if(e.match_start=i,s=r,r>=o)break;c=l[n+s-1],b=l[n+s]}}while((i=p[i&f])>h&&--t!==0);return s<=e.lookahead?s:e.lookahead},ze=e=>{const i=e.w_size;let t,n,a;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-ie)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),dr(e),n+=i),e.strm.avail_in===0)break;if(t=Ht(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=z)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=ce(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=ce(e,e.ins_h,e.window[a+z-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<z)););}while(e.lookahead<ie&&e.strm.avail_in!==0)},vn=(e,i)=>{let t=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,n,a,r,s=0,o=e.strm.avail_in;do{if(n=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r||(r=e.strm.avail_out-r,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>r&&(n=r),n<t&&(n===0&&i!==j||i===he||n!==a+e.strm.avail_in)))break;s=i===j&&n===a+e.strm.avail_in?1:0,Nt(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,P(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(Ht(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(s===0);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?Ze:i!==he&&i!==j&&e.strm.avail_in===0&&e.strstart===e.block_start?De:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(Ht(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,t=r>e.w_size?e.w_size:r,a=e.strstart-e.block_start,(a>=t||(a||i===j)&&i!==he&&e.strm.avail_in===0&&a<=r)&&(n=a>r?r:a,s=i===j&&e.strm.avail_in===0&&n===a?1:0,Nt(e,e.block_start,n,s),e.block_start+=n,P(e.strm)),s?pe:B)},Et=(e,i)=>{let t,n;for(;;){if(e.lookahead<ie){if(ze(e),e.lookahead<ie&&i===he)return B;if(e.lookahead===0)break}if(t=0,e.lookahead>=z&&(e.ins_h=ce(e,e.ins_h,e.window[e.strstart+z-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-ie&&(e.match_length=xn(e,t)),e.match_length>=z)if(n=fe(e,e.strstart-e.match_start,e.match_length-z),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=z){e.match_length--;do e.strstart++,e.ins_h=ce(e,e.ins_h,e.window[e.strstart+z-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ce(e,e.ins_h,e.window[e.strstart+1]);else n=fe(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&($(e,!1),e.strm.avail_out===0))return B}return e.insert=e.strstart<z-1?e.strstart:z-1,i===j?($(e,!0),e.strm.avail_out===0?pe:Ze):e.sym_next&&($(e,!1),e.strm.avail_out===0)?B:De},ye=(e,i)=>{let t,n,a;for(;;){if(e.lookahead<ie){if(ze(e),e.lookahead<ie&&i===he)return B;if(e.lookahead===0)break}if(t=0,e.lookahead>=z&&(e.ins_h=ce(e,e.ins_h,e.window[e.strstart+z-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=z-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-ie&&(e.match_length=xn(e,t),e.match_length<=5&&(e.strategy===qa||e.match_length===z&&e.strstart-e.match_start>4096)&&(e.match_length=z-1)),e.prev_length>=z&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-z,n=fe(e,e.strstart-1-e.prev_match,e.prev_length-z),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=ce(e,e.ins_h,e.window[e.strstart+z-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=z-1,e.strstart++,n&&($(e,!1),e.strm.avail_out===0))return B}else if(e.match_available){if(n=fe(e,0,e.window[e.strstart-1]),n&&$(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return B}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=fe(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<z-1?e.strstart:z-1,i===j?($(e,!0),e.strm.avail_out===0?pe:Ze):e.sym_next&&($(e,!1),e.strm.avail_out===0)?B:De},br=(e,i)=>{let t,n,a,r;const s=e.window;for(;;){if(e.lookahead<=se){if(ze(e),e.lookahead<=se&&i===he)return B;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=z&&e.strstart>0&&(a=e.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){r=e.strstart+se;do;while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<r);e.match_length=se-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=z?(t=fe(e,1,e.match_length-z),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=fe(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&($(e,!1),e.strm.avail_out===0))return B}return e.insert=0,i===j?($(e,!0),e.strm.avail_out===0?pe:Ze):e.sym_next&&($(e,!1),e.strm.avail_out===0)?B:De},wr=(e,i)=>{let t;for(;;){if(e.lookahead===0&&(ze(e),e.lookahead===0)){if(i===he)return B;break}if(e.match_length=0,t=fe(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&($(e,!1),e.strm.avail_out===0))return B}return e.insert=0,i===j?($(e,!0),e.strm.avail_out===0?pe:Ze):e.sym_next&&($(e,!1),e.strm.avail_out===0)?B:De};function Q(e,i,t,n,a){this.good_length=e,this.max_lazy=i,this.nice_length=t,this.max_chain=n,this.func=a}const Le=[new Q(0,0,0,0,vn),new Q(4,4,8,4,Et),new Q(4,5,16,8,Et),new Q(4,6,32,32,Et),new Q(4,4,16,16,ye),new Q(8,16,32,32,ye),new Q(8,16,128,128,ye),new Q(8,32,128,256,ye),new Q(32,128,258,1024,ye),new Q(32,258,258,4096,ye)],gr=e=>{e.window_size=2*e.w_size,le(e.head),e.max_lazy_match=Le[e.level].max_lazy,e.good_match=Le[e.level].good_length,e.nice_match=Le[e.level].nice_length,e.max_chain_length=Le[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=z-1,e.match_available=0,e.ins_h=0};function pr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ut,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(fr*2),this.dyn_dtree=new Uint16Array((2*lr+1)*2),this.bl_tree=new Uint16Array((2*sr+1)*2),le(this.dyn_ltree),le(this.dyn_dtree),le(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(hr+1),this.heap=new Uint16Array(2*Lt+1),le(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Lt+1),le(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qe=e=>{if(!e)return 1;const i=e.state;return!i||i.strm!==e||i.status!==Te&&i.status!==jt&&i.status!==Ut&&i.status!==Ot&&i.status!==Bt&&i.status!==Ft&&i.status!==ue&&i.status!==Ne?1:0},kn=e=>{if(qe(e))return be(e,te);e.total_in=e.total_out=0,e.data_type=tr;const i=e.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?jt:i.wrap?Te:ue,e.adler=i.wrap===2?0:1,i.last_flush=-2,Xa(i),U},yn=e=>{const i=kn(e);return i===U&&gr(e.state),i},mr=(e,i)=>qe(e)||e.state.wrap!==2?te:(e.state.gzhead=i,U),En=(e,i,t,n,a,r)=>{if(!e)return te;let s=1;if(i===Va&&(i=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>ir||t!==ut||n<8||n>15||i<0||i>9||r<0||r>Qa||n===8&&s!==1)return be(e,te);n===8&&(n=9);const o=new pr;return e.state=o,o.strm=e,o.status=Te,o.wrap=s,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+z-1)/z),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=(o.lit_bufsize-1)*3,o.level=i,o.strategy=r,o.method=t,yn(e)},xr=(e,i)=>En(e,i,ut,nr,ar,er),vr=(e,i)=>{if(qe(e)||i>di||i<0)return e?be(e,te):te;const t=e.state;if(!e.output||e.avail_in!==0&&!e.input||t.status===Ne&&i!==j)return be(e,e.avail_out===0?yt:te);const n=t.last_flush;if(t.last_flush=i,t.pending!==0){if(P(e),e.avail_out===0)return t.last_flush=-1,U}else if(e.avail_in===0&&bi(i)<=bi(n)&&i!==j)return be(e,yt);if(t.status===Ne&&e.avail_in!==0)return be(e,yt);if(t.status===Te&&t.wrap===0&&(t.status=ue),t.status===Te){let a=ut+(t.w_bits-8<<4)<<8,r=-1;if(t.strategy>=it||t.level<2?r=0:t.level<6?r=1:t.level===6?r=2:r=3,a|=r<<6,t.strstart!==0&&(a|=cr),a+=31-a%31,Me(t,a),t.strstart!==0&&(Me(t,e.adler>>>16),Me(t,e.adler&65535)),e.adler=1,t.status=ue,P(e),t.pending!==0)return t.last_flush=-1,U}if(t.status===jt){if(e.adler=0,D(t,31),D(t,139),D(t,8),t.gzhead)D(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),D(t,t.gzhead.time&255),D(t,t.gzhead.time>>8&255),D(t,t.gzhead.time>>16&255),D(t,t.gzhead.time>>24&255),D(t,t.level===9?2:t.strategy>=it||t.level<2?4:0),D(t,t.gzhead.os&255),t.gzhead.extra&&t.gzhead.extra.length&&(D(t,t.gzhead.extra.length&255),D(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(e.adler=L(e.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=Ut;else if(D(t,0),D(t,0),D(t,0),D(t,0),D(t,0),D(t,t.level===9?2:t.strategy>=it||t.level<2?4:0),D(t,_r),t.status=ue,P(e),t.pending!==0)return t.last_flush=-1,U}if(t.status===Ut){if(t.gzhead.extra){let a=t.pending,r=(t.gzhead.extra.length&65535)-t.gzindex;for(;t.pending+r>t.pending_buf_size;){let o=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+o),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex+=o,P(e),t.pending!==0)return t.last_flush=-1,U;a=0,r-=o}let s=new Uint8Array(t.gzhead.extra);t.pending_buf.set(s.subarray(t.gzindex,t.gzindex+r),t.pending),t.pending+=r,t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=Ot}if(t.status===Ot){if(t.gzhead.name){let a=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a)),P(e),t.pending!==0)return t.last_flush=-1,U;a=0}t.gzindex<t.gzhead.name.length?r=t.gzhead.name.charCodeAt(t.gzindex++)&255:r=0,D(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a)),t.gzindex=0}t.status=Bt}if(t.status===Bt){if(t.gzhead.comment){let a=t.pending,r;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a)),P(e),t.pending!==0)return t.last_flush=-1,U;a=0}t.gzindex<t.gzhead.comment.length?r=t.gzhead.comment.charCodeAt(t.gzindex++)&255:r=0,D(t,r)}while(r!==0);t.gzhead.hcrc&&t.pending>a&&(e.adler=L(e.adler,t.pending_buf,t.pending-a,a))}t.status=Ft}if(t.status===Ft){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(P(e),t.pending!==0))return t.last_flush=-1,U;D(t,e.adler&255),D(t,e.adler>>8&255),e.adler=0}if(t.status=ue,P(e),t.pending!==0)return t.last_flush=-1,U}if(e.avail_in!==0||t.lookahead!==0||i!==he&&t.status!==Ne){let a=t.level===0?vn(t,i):t.strategy===it?wr(t,i):t.strategy===Ja?br(t,i):Le[t.level].func(t,i);if((a===pe||a===Ze)&&(t.status=Ne),a===B||a===pe)return e.avail_out===0&&(t.last_flush=-1),U;if(a===De&&(i===Ka?Ga(t):i!==di&&(Nt(t,0,0,!1),i===ja&&(le(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),P(e),e.avail_out===0))return t.last_flush=-1,U}return i!==j?U:t.wrap<=0?ui:(t.wrap===2?(D(t,e.adler&255),D(t,e.adler>>8&255),D(t,e.adler>>16&255),D(t,e.adler>>24&255),D(t,e.total_in&255),D(t,e.total_in>>8&255),D(t,e.total_in>>16&255),D(t,e.total_in>>24&255)):(Me(t,e.adler>>>16),Me(t,e.adler&65535)),P(e),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?U:ui)},kr=e=>{if(qe(e))return te;const i=e.state.status;return e.state=null,i===ue?be(e,Wa):U},yr=(e,i)=>{let t=i.length;if(qe(e))return te;const n=e.state,a=n.wrap;if(a===2||a===1&&n.status!==Te||n.lookahead)return te;if(a===1&&(e.adler=$e(e.adler,i,t,0)),n.wrap=0,t>=n.w_size){a===0&&(le(n.head),n.strstart=0,n.block_start=0,n.insert=0);let h=new Uint8Array(n.w_size);h.set(i.subarray(t-n.w_size,t),0),i=h,t=n.w_size}const r=e.avail_in,s=e.next_in,o=e.input;for(e.avail_in=t,e.next_in=0,e.input=i,ze(n);n.lookahead>=z;){let h=n.strstart,l=n.lookahead-(z-1);do n.ins_h=ce(n,n.ins_h,n.window[h+z-1]),n.prev[h&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=h,h++;while(--l);n.strstart=h,n.lookahead=z-1,ze(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=z-1,n.match_available=0,e.next_in=s,e.input=o,e.avail_in=r,n.wrap=a,U};var Er=xr,Ar=En,Sr=yn,Tr=kn,zr=mr,Rr=vr,Dr=kr,Zr=yr,Cr="pako deflate (from Nodeca project)",Be={deflateInit:Er,deflateInit2:Ar,deflateReset:Sr,deflateResetKeep:Tr,deflateSetHeader:zr,deflate:Rr,deflateEnd:Dr,deflateSetDictionary:Zr,deflateInfo:Cr};const Ir=(e,i)=>Object.prototype.hasOwnProperty.call(e,i);var Mr=function(e){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const t=i.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)Ir(t,n)&&(e[n]=t[n])}}return e},Nr=e=>{let i=0;for(let n=0,a=e.length;n<a;n++)i+=e[n].length;const t=new Uint8Array(i);for(let n=0,a=0,r=e.length;n<r;n++){let s=e[n];t.set(s,a),a+=s.length}return t},bt={assign:Mr,flattenChunks:Nr};let An=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{An=!1}const Ge=new Uint8Array(256);for(let e=0;e<256;e++)Ge[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ge[254]=Ge[254]=1;var Lr=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let i,t,n,a,r,s=e.length,o=0;for(a=0;a<s;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<s&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),a++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(i=new Uint8Array(o),r=0,a=0;r<o;a++)t=e.charCodeAt(a),(t&64512)===55296&&a+1<s&&(n=e.charCodeAt(a+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),a++)),t<128?i[r++]=t:t<2048?(i[r++]=192|t>>>6,i[r++]=128|t&63):t<65536?(i[r++]=224|t>>>12,i[r++]=128|t>>>6&63,i[r++]=128|t&63):(i[r++]=240|t>>>18,i[r++]=128|t>>>12&63,i[r++]=128|t>>>6&63,i[r++]=128|t&63);return i};const Ur=(e,i)=>{if(i<65534&&e.subarray&&An)return String.fromCharCode.apply(null,e.length===i?e:e.subarray(0,i));let t="";for(let n=0;n<i;n++)t+=String.fromCharCode(e[n]);return t};var Or=(e,i)=>{const t=i||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,i));let n,a;const r=new Array(t*2);for(a=0,n=0;n<t;){let s=e[n++];if(s<128){r[a++]=s;continue}let o=Ge[s];if(o>4){r[a++]=65533,n+=o-1;continue}for(s&=o===2?31:o===3?15:7;o>1&&n<t;)s=s<<6|e[n++]&63,o--;if(o>1){r[a++]=65533;continue}s<65536?r[a++]=s:(s-=65536,r[a++]=55296|s>>10&1023,r[a++]=56320|s&1023)}return Ur(r,a)},Br=(e,i)=>{i=i||e.length,i>e.length&&(i=e.length);let t=i-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?i:t+Ge[e[t]]>i?t:i},Ke={string2buf:Lr,buf2string:Or,utf8border:Br};function Fr(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Sn=Fr;const Tn=Object.prototype.toString,{Z_NO_FLUSH:Hr,Z_SYNC_FLUSH:Pr,Z_FULL_FLUSH:Yr,Z_FINISH:Xr,Z_OK:ct,Z_STREAM_END:$r,Z_DEFAULT_COMPRESSION:Gr,Z_DEFAULT_STRATEGY:Kr,Z_DEFLATED:jr}=xe;function Je(e){this.options=bt.assign({level:Gr,method:jr,chunkSize:16384,windowBits:15,memLevel:8,strategy:Kr},e||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sn,this.strm.avail_out=0;let t=Be.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(t!==ct)throw new Error(ge[t]);if(i.header&&Be.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=Ke.string2buf(i.dictionary):Tn.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,t=Be.deflateSetDictionary(this.strm,n),t!==ct)throw new Error(ge[t]);this._dict_set=!0}}Je.prototype.push=function(e,i){const t=this.strm,n=this.options.chunkSize;let a,r;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?Xr:Hr,typeof e=="string"?t.input=Ke.string2buf(e):Tn.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(r===Pr||r===Yr)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(a=Be.deflate(t,r),a===$r)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),a=Be.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===ct;if(t.avail_out===0){this.onData(t.output);continue}if(r>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};Je.prototype.onData=function(e){this.chunks.push(e)};Je.prototype.onEnd=function(e){e===ct&&(this.result=bt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Wt(e,i){const t=new Je(i);if(t.push(e,!0),t.err)throw t.msg||ge[t.err];return t.result}function Wr(e,i){return i=i||{},i.raw=!0,Wt(e,i)}function Vr(e,i){return i=i||{},i.gzip=!0,Wt(e,i)}var qr=Je,Jr=Wt,Qr=Wr,eo=Vr,to=xe,io={Deflate:qr,deflate:Jr,deflateRaw:Qr,gzip:eo,constants:to};const nt=16209,no=16191;var ao=function(i,t){let n,a,r,s,o,h,l,f,p,d,c,b,E,v,x,A,g,_,m,w,u,S,T,k;const y=i.state;n=i.next_in,T=i.input,a=n+(i.avail_in-5),r=i.next_out,k=i.output,s=r-(t-i.avail_out),o=r+(i.avail_out-257),h=y.dmax,l=y.wsize,f=y.whave,p=y.wnext,d=y.window,c=y.hold,b=y.bits,E=y.lencode,v=y.distcode,x=(1<<y.lenbits)-1,A=(1<<y.distbits)-1;e:do{b<15&&(c+=T[n++]<<b,b+=8,c+=T[n++]<<b,b+=8),g=E[c&x];t:for(;;){if(_=g>>>24,c>>>=_,b-=_,_=g>>>16&255,_===0)k[r++]=g&65535;else if(_&16){m=g&65535,_&=15,_&&(b<_&&(c+=T[n++]<<b,b+=8),m+=c&(1<<_)-1,c>>>=_,b-=_),b<15&&(c+=T[n++]<<b,b+=8,c+=T[n++]<<b,b+=8),g=v[c&A];i:for(;;){if(_=g>>>24,c>>>=_,b-=_,_=g>>>16&255,_&16){if(w=g&65535,_&=15,b<_&&(c+=T[n++]<<b,b+=8,b<_&&(c+=T[n++]<<b,b+=8)),w+=c&(1<<_)-1,w>h){i.msg="invalid distance too far back",y.mode=nt;break e}if(c>>>=_,b-=_,_=r-s,w>_){if(_=w-_,_>f&&y.sane){i.msg="invalid distance too far back",y.mode=nt;break e}if(u=0,S=d,p===0){if(u+=l-_,_<m){m-=_;do k[r++]=d[u++];while(--_);u=r-w,S=k}}else if(p<_){if(u+=l+p-_,_-=p,_<m){m-=_;do k[r++]=d[u++];while(--_);if(u=0,p<m){_=p,m-=_;do k[r++]=d[u++];while(--_);u=r-w,S=k}}}else if(u+=p-_,_<m){m-=_;do k[r++]=d[u++];while(--_);u=r-w,S=k}for(;m>2;)k[r++]=S[u++],k[r++]=S[u++],k[r++]=S[u++],m-=3;m&&(k[r++]=S[u++],m>1&&(k[r++]=S[u++]))}else{u=r-w;do k[r++]=k[u++],k[r++]=k[u++],k[r++]=k[u++],m-=3;while(m>2);m&&(k[r++]=k[u++],m>1&&(k[r++]=k[u++]))}}else if(_&64){i.msg="invalid distance code",y.mode=nt;break e}else{g=v[(g&65535)+(c&(1<<_)-1)];continue i}break}}else if(_&64)if(_&32){y.mode=no;break e}else{i.msg="invalid literal/length code",y.mode=nt;break e}else{g=E[(g&65535)+(c&(1<<_)-1)];continue t}break}}while(n<a&&r<o);m=b>>3,n-=m,b-=m<<3,c&=(1<<b)-1,i.next_in=n,i.next_out=r,i.avail_in=n<a?5+(a-n):5-(n-a),i.avail_out=r<o?257+(o-r):257-(r-o),y.hold=c,y.bits=b};const Ee=15,wi=852,gi=592,pi=0,At=1,mi=2,ro=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),oo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),lo=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),so=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),fo=(e,i,t,n,a,r,s,o)=>{const h=o.bits;let l=0,f=0,p=0,d=0,c=0,b=0,E=0,v=0,x=0,A=0,g,_,m,w,u,S=null,T;const k=new Uint16Array(Ee+1),y=new Uint16Array(Ee+1);let H=null,ai,et,tt;for(l=0;l<=Ee;l++)k[l]=0;for(f=0;f<n;f++)k[i[t+f]]++;for(c=h,d=Ee;d>=1&&k[d]===0;d--);if(c>d&&(c=d),d===0)return a[r++]=1<<24|64<<16|0,a[r++]=1<<24|64<<16|0,o.bits=1,0;for(p=1;p<d&&k[p]===0;p++);for(c<p&&(c=p),v=1,l=1;l<=Ee;l++)if(v<<=1,v-=k[l],v<0)return-1;if(v>0&&(e===pi||d!==1))return-1;for(y[1]=0,l=1;l<Ee;l++)y[l+1]=y[l]+k[l];for(f=0;f<n;f++)i[t+f]!==0&&(s[y[i[t+f]]++]=f);if(e===pi?(S=H=s,T=20):e===At?(S=ro,H=oo,T=257):(S=lo,H=so,T=0),A=0,f=0,l=p,u=r,b=c,E=0,m=-1,x=1<<c,w=x-1,e===At&&x>wi||e===mi&&x>gi)return 1;for(;;){ai=l-E,s[f]+1<T?(et=0,tt=s[f]):s[f]>=T?(et=H[s[f]-T],tt=S[s[f]-T]):(et=96,tt=0),g=1<<l-E,_=1<<b,p=_;do _-=g,a[u+(A>>E)+_]=ai<<24|et<<16|tt|0;while(_!==0);for(g=1<<l-1;A&g;)g>>=1;if(g!==0?(A&=g-1,A+=g):A=0,f++,--k[l]===0){if(l===d)break;l=i[t+s[f]]}if(l>c&&(A&w)!==m){for(E===0&&(E=c),u+=p,b=l-E,v=1<<b;b+E<d&&(v-=k[b+E],!(v<=0));)b++,v<<=1;if(x+=1<<b,e===At&&x>wi||e===mi&&x>gi)return 1;m=A&w,a[m]=c<<24|b<<16|u-r|0}}return A!==0&&(a[u+A]=l-E<<24|64<<16|0),o.bits=c,0};var Fe=fo;const ho=0,zn=1,Rn=2,{Z_FINISH:xi,Z_BLOCK:co,Z_TREES:at,Z_OK:me,Z_STREAM_END:_o,Z_NEED_DICT:uo,Z_STREAM_ERROR:W,Z_DATA_ERROR:Dn,Z_MEM_ERROR:Zn,Z_BUF_ERROR:bo,Z_DEFLATED:vi}=xe,wt=16180,ki=16181,yi=16182,Ei=16183,Ai=16184,Si=16185,Ti=16186,zi=16187,Ri=16188,Di=16189,_t=16190,ne=16191,St=16192,Zi=16193,Tt=16194,Ci=16195,Ii=16196,Mi=16197,Ni=16198,rt=16199,ot=16200,Li=16201,Ui=16202,Oi=16203,Bi=16204,Fi=16205,zt=16206,Hi=16207,Pi=16208,I=16209,Cn=16210,In=16211,wo=852,go=592,po=15,mo=po,Yi=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function xo(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ve=e=>{if(!e)return 1;const i=e.state;return!i||i.strm!==e||i.mode<wt||i.mode>In?1:0},Mn=e=>{if(ve(e))return W;const i=e.state;return e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=i.wrap&1),i.mode=wt,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(wo),i.distcode=i.distdyn=new Int32Array(go),i.sane=1,i.back=-1,me},Nn=e=>{if(ve(e))return W;const i=e.state;return i.wsize=0,i.whave=0,i.wnext=0,Mn(e)},Ln=(e,i)=>{let t;if(ve(e))return W;const n=e.state;return i<0?(t=0,i=-i):(t=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?W:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=t,n.wbits=i,Nn(e))},Un=(e,i)=>{if(!e)return W;const t=new xo;e.state=t,t.strm=e,t.window=null,t.mode=wt;const n=Ln(e,i);return n!==me&&(e.state=null),n},vo=e=>Un(e,mo);let Xi=!0,Rt,Dt;const ko=e=>{if(Xi){Rt=new Int32Array(512),Dt=new Int32Array(32);let i=0;for(;i<144;)e.lens[i++]=8;for(;i<256;)e.lens[i++]=9;for(;i<280;)e.lens[i++]=7;for(;i<288;)e.lens[i++]=8;for(Fe(zn,e.lens,0,288,Rt,0,e.work,{bits:9}),i=0;i<32;)e.lens[i++]=5;Fe(Rn,e.lens,0,32,Dt,0,e.work,{bits:5}),Xi=!1}e.lencode=Rt,e.lenbits=9,e.distcode=Dt,e.distbits=5},On=(e,i,t,n)=>{let a;const r=e.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(i.subarray(t-r.wsize,t),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),r.window.set(i.subarray(t-n,t-n+a),r.wnext),n-=a,n?(r.window.set(i.subarray(t-n,t),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},yo=(e,i)=>{let t,n,a,r,s,o,h,l,f,p,d,c,b,E,v=0,x,A,g,_,m,w,u,S;const T=new Uint8Array(4);let k,y;const H=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ve(e)||!e.output||!e.input&&e.avail_in!==0)return W;t=e.state,t.mode===ne&&(t.mode=St),s=e.next_out,a=e.output,h=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,l=t.hold,f=t.bits,p=o,d=h,S=me;e:for(;;)switch(t.mode){case wt:if(t.wrap===0){t.mode=St;break}for(;f<16;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(t.wrap&2&&l===35615){t.wbits===0&&(t.wbits=15),t.check=0,T[0]=l&255,T[1]=l>>>8&255,t.check=L(t.check,T,2,0),l=0,f=0,t.mode=ki;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",t.mode=I;break}if((l&15)!==vi){e.msg="unknown compression method",t.mode=I;break}if(l>>>=4,f-=4,u=(l&15)+8,t.wbits===0&&(t.wbits=u),u>15||u>t.wbits){e.msg="invalid window size",t.mode=I;break}t.dmax=1<<t.wbits,t.flags=0,e.adler=t.check=1,t.mode=l&512?Di:ne,l=0,f=0;break;case ki:for(;f<16;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(t.flags=l,(t.flags&255)!==vi){e.msg="unknown compression method",t.mode=I;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=I;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&t.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,t.check=L(t.check,T,2,0)),l=0,f=0,t.mode=yi;case yi:for(;f<32;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.head&&(t.head.time=l),t.flags&512&&t.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,t.check=L(t.check,T,4,0)),l=0,f=0,t.mode=Ei;case Ei:for(;f<16;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&t.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,t.check=L(t.check,T,2,0)),l=0,f=0,t.mode=Ai;case Ai:if(t.flags&1024){for(;f<16;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&t.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,t.check=L(t.check,T,2,0)),l=0,f=0}else t.head&&(t.head.extra=null);t.mode=Si;case Si:if(t.flags&1024&&(c=t.length,c>o&&(c=o),c&&(t.head&&(u=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(r,r+c),u)),t.flags&512&&t.wrap&4&&(t.check=L(t.check,n,c,r)),o-=c,r+=c,t.length-=c),t.length))break e;t.length=0,t.mode=Ti;case Ti:if(t.flags&2048){if(o===0)break e;c=0;do u=n[r+c++],t.head&&u&&t.length<65536&&(t.head.name+=String.fromCharCode(u));while(u&&c<o);if(t.flags&512&&t.wrap&4&&(t.check=L(t.check,n,c,r)),o-=c,r+=c,u)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=zi;case zi:if(t.flags&4096){if(o===0)break e;c=0;do u=n[r+c++],t.head&&u&&t.length<65536&&(t.head.comment+=String.fromCharCode(u));while(u&&c<o);if(t.flags&512&&t.wrap&4&&(t.check=L(t.check,n,c,r)),o-=c,r+=c,u)break e}else t.head&&(t.head.comment=null);t.mode=Ri;case Ri:if(t.flags&512){for(;f<16;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.check&65535)){e.msg="header crc mismatch",t.mode=I;break}l=0,f=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=ne;break;case Di:for(;f<32;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}e.adler=t.check=Yi(l),l=0,f=0,t.mode=_t;case _t:if(t.havedict===0)return e.next_out=s,e.avail_out=h,e.next_in=r,e.avail_in=o,t.hold=l,t.bits=f,uo;e.adler=t.check=1,t.mode=ne;case ne:if(i===co||i===at)break e;case St:if(t.last){l>>>=f&7,f-=f&7,t.mode=zt;break}for(;f<3;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}switch(t.last=l&1,l>>>=1,f-=1,l&3){case 0:t.mode=Zi;break;case 1:if(ko(t),t.mode=rt,i===at){l>>>=2,f-=2;break e}break;case 2:t.mode=Ii;break;case 3:e.msg="invalid block type",t.mode=I}l>>>=2,f-=2;break;case Zi:for(l>>>=f&7,f-=f&7;f<32;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",t.mode=I;break}if(t.length=l&65535,l=0,f=0,t.mode=Tt,i===at)break e;case Tt:t.mode=Ci;case Ci:if(c=t.length,c){if(c>o&&(c=o),c>h&&(c=h),c===0)break e;a.set(n.subarray(r,r+c),s),o-=c,r+=c,h-=c,s+=c,t.length-=c;break}t.mode=ne;break;case Ii:for(;f<14;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(t.nlen=(l&31)+257,l>>>=5,f-=5,t.ndist=(l&31)+1,l>>>=5,f-=5,t.ncode=(l&15)+4,l>>>=4,f-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=I;break}t.have=0,t.mode=Mi;case Mi:for(;t.have<t.ncode;){for(;f<3;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.lens[H[t.have++]]=l&7,l>>>=3,f-=3}for(;t.have<19;)t.lens[H[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,k={bits:t.lenbits},S=Fe(ho,t.lens,0,19,t.lencode,0,t.work,k),t.lenbits=k.bits,S){e.msg="invalid code lengths set",t.mode=I;break}t.have=0,t.mode=Ni;case Ni:for(;t.have<t.nlen+t.ndist;){for(;v=t.lencode[l&(1<<t.lenbits)-1],x=v>>>24,A=v>>>16&255,g=v&65535,!(x<=f);){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(g<16)l>>>=x,f-=x,t.lens[t.have++]=g;else{if(g===16){for(y=x+2;f<y;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(l>>>=x,f-=x,t.have===0){e.msg="invalid bit length repeat",t.mode=I;break}u=t.lens[t.have-1],c=3+(l&3),l>>>=2,f-=2}else if(g===17){for(y=x+3;f<y;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,u=0,c=3+(l&7),l>>>=3,f-=3}else{for(y=x+7;f<y;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}l>>>=x,f-=x,u=0,c=11+(l&127),l>>>=7,f-=7}if(t.have+c>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=I;break}for(;c--;)t.lens[t.have++]=u}}if(t.mode===I)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=I;break}if(t.lenbits=9,k={bits:t.lenbits},S=Fe(zn,t.lens,0,t.nlen,t.lencode,0,t.work,k),t.lenbits=k.bits,S){e.msg="invalid literal/lengths set",t.mode=I;break}if(t.distbits=6,t.distcode=t.distdyn,k={bits:t.distbits},S=Fe(Rn,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,k),t.distbits=k.bits,S){e.msg="invalid distances set",t.mode=I;break}if(t.mode=rt,i===at)break e;case rt:t.mode=ot;case ot:if(o>=6&&h>=258){e.next_out=s,e.avail_out=h,e.next_in=r,e.avail_in=o,t.hold=l,t.bits=f,ao(e,d),s=e.next_out,a=e.output,h=e.avail_out,r=e.next_in,n=e.input,o=e.avail_in,l=t.hold,f=t.bits,t.mode===ne&&(t.back=-1);break}for(t.back=0;v=t.lencode[l&(1<<t.lenbits)-1],x=v>>>24,A=v>>>16&255,g=v&65535,!(x<=f);){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(A&&!(A&240)){for(_=x,m=A,w=g;v=t.lencode[w+((l&(1<<_+m)-1)>>_)],x=v>>>24,A=v>>>16&255,g=v&65535,!(_+x<=f);){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}l>>>=_,f-=_,t.back+=_}if(l>>>=x,f-=x,t.back+=x,t.length=g,A===0){t.mode=Fi;break}if(A&32){t.back=-1,t.mode=ne;break}if(A&64){e.msg="invalid literal/length code",t.mode=I;break}t.extra=A&15,t.mode=Li;case Li:if(t.extra){for(y=t.extra;f<y;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=Ui;case Ui:for(;v=t.distcode[l&(1<<t.distbits)-1],x=v>>>24,A=v>>>16&255,g=v&65535,!(x<=f);){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(!(A&240)){for(_=x,m=A,w=g;v=t.distcode[w+((l&(1<<_+m)-1)>>_)],x=v>>>24,A=v>>>16&255,g=v&65535,!(_+x<=f);){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}l>>>=_,f-=_,t.back+=_}if(l>>>=x,f-=x,t.back+=x,A&64){e.msg="invalid distance code",t.mode=I;break}t.offset=g,t.extra=A&15,t.mode=Oi;case Oi:if(t.extra){for(y=t.extra;f<y;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,f-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=I;break}t.mode=Bi;case Bi:if(h===0)break e;if(c=d-h,t.offset>c){if(c=t.offset-c,c>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=I;break}c>t.wnext?(c-=t.wnext,b=t.wsize-c):b=t.wnext-c,c>t.length&&(c=t.length),E=t.window}else E=a,b=s-t.offset,c=t.length;c>h&&(c=h),h-=c,t.length-=c;do a[s++]=E[b++];while(--c);t.length===0&&(t.mode=ot);break;case Fi:if(h===0)break e;a[s++]=t.length,h--,t.mode=ot;break;case zt:if(t.wrap){for(;f<32;){if(o===0)break e;o--,l|=n[r++]<<f,f+=8}if(d-=h,e.total_out+=d,t.total+=d,t.wrap&4&&d&&(e.adler=t.check=t.flags?L(t.check,a,d,s-d):$e(t.check,a,d,s-d)),d=h,t.wrap&4&&(t.flags?l:Yi(l))!==t.check){e.msg="incorrect data check",t.mode=I;break}l=0,f=0}t.mode=Hi;case Hi:if(t.wrap&&t.flags){for(;f<32;){if(o===0)break e;o--,l+=n[r++]<<f,f+=8}if(t.wrap&4&&l!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=I;break}l=0,f=0}t.mode=Pi;case Pi:S=_o;break e;case I:S=Dn;break e;case Cn:return Zn;case In:default:return W}return e.next_out=s,e.avail_out=h,e.next_in=r,e.avail_in=o,t.hold=l,t.bits=f,(t.wsize||d!==e.avail_out&&t.mode<I&&(t.mode<zt||i!==xi))&&On(e,e.output,e.next_out,d-e.avail_out),p-=e.avail_in,d-=e.avail_out,e.total_in+=p,e.total_out+=d,t.total+=d,t.wrap&4&&d&&(e.adler=t.check=t.flags?L(t.check,a,d,e.next_out-d):$e(t.check,a,d,e.next_out-d)),e.data_type=t.bits+(t.last?64:0)+(t.mode===ne?128:0)+(t.mode===rt||t.mode===Tt?256:0),(p===0&&d===0||i===xi)&&S===me&&(S=bo),S},Eo=e=>{if(ve(e))return W;let i=e.state;return i.window&&(i.window=null),e.state=null,me},Ao=(e,i)=>{if(ve(e))return W;const t=e.state;return t.wrap&2?(t.head=i,i.done=!1,me):W},So=(e,i)=>{const t=i.length;let n,a,r;return ve(e)||(n=e.state,n.wrap!==0&&n.mode!==_t)?W:n.mode===_t&&(a=1,a=$e(a,i,t,0),a!==n.check)?Dn:(r=On(e,i,t,t),r?(n.mode=Cn,Zn):(n.havedict=1,me))};var To=Nn,zo=Ln,Ro=Mn,Do=vo,Zo=Un,Co=yo,Io=Eo,Mo=Ao,No=So,Lo="pako inflate (from Nodeca project)",oe={inflateReset:To,inflateReset2:zo,inflateResetKeep:Ro,inflateInit:Do,inflateInit2:Zo,inflate:Co,inflateEnd:Io,inflateGetHeader:Mo,inflateSetDictionary:No,inflateInfo:Lo};function Uo(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Oo=Uo;const Bn=Object.prototype.toString,{Z_NO_FLUSH:Bo,Z_FINISH:Fo,Z_OK:je,Z_STREAM_END:Zt,Z_NEED_DICT:Ct,Z_STREAM_ERROR:Ho,Z_DATA_ERROR:$i,Z_MEM_ERROR:Po}=xe;function Qe(e){this.options=bt.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(e&&e.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sn,this.strm.avail_out=0;let t=oe.inflateInit2(this.strm,i.windowBits);if(t!==je)throw new Error(ge[t]);if(this.header=new Oo,oe.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Ke.string2buf(i.dictionary):Bn.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(t=oe.inflateSetDictionary(this.strm,i.dictionary),t!==je)))throw new Error(ge[t])}Qe.prototype.push=function(e,i){const t=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let r,s,o;if(this.ended)return!1;for(i===~~i?s=i:s=i===!0?Fo:Bo,Bn.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),r=oe.inflate(t,s),r===Ct&&a&&(r=oe.inflateSetDictionary(t,a),r===je?r=oe.inflate(t,s):r===$i&&(r=Ct));t.avail_in>0&&r===Zt&&t.state.wrap>0&&e[t.next_in]!==0;)oe.inflateReset(t),r=oe.inflate(t,s);switch(r){case Ho:case $i:case Ct:case Po:return this.onEnd(r),this.ended=!0,!1}if(o=t.avail_out,t.next_out&&(t.avail_out===0||r===Zt))if(this.options.to==="string"){let h=Ke.utf8border(t.output,t.next_out),l=t.next_out-h,f=Ke.buf2string(t.output,h);t.next_out=l,t.avail_out=n-l,l&&t.output.set(t.output.subarray(h,h+l),0),this.onData(f)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(r===je&&o===0)){if(r===Zt)return r=oe.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};Qe.prototype.onData=function(e){this.chunks.push(e)};Qe.prototype.onEnd=function(e){e===je&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=bt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function Vt(e,i){const t=new Qe(i);if(t.push(e),t.err)throw t.msg||ge[t.err];return t.result}function Yo(e,i){return i=i||{},i.raw=!0,Vt(e,i)}var Xo=Qe,$o=Vt,Go=Yo,Ko=Vt,jo=xe,Wo={Inflate:Xo,inflate:$o,inflateRaw:Go,ungzip:Ko,constants:jo};const{Deflate:Vo,deflate:qo,deflateRaw:Jo,gzip:Qo}=io,{Inflate:el,inflate:tl,inflateRaw:il,ungzip:nl}=Wo;var al=Vo,rl=qo,ol=Jo,ll=Qo,sl=el,fl=tl,hl=il,cl=nl,_l=xe,Gi={Deflate:al,deflate:rl,deflateRaw:ol,gzip:ll,Inflate:sl,inflate:fl,inflateRaw:hl,ungzip:cl,constants:_l};class Ki{constructor(i){R(this,"buffer");R(this,"bytePointer",0);R(this,"bitPointer",0);this.buffer=typeof i=="number"?new ArrayBuffer(i):"buffer"in i?i.buffer:i}get view(){return new DataView(this.buffer)}skipBits(i){this.bitPointer+=i,this.bytePointer+=Math.floor(this.bitPointer/8),this.bitPointer%=8}final(){return this.buffer.slice(0,this.bitPointer==0?this.bytePointer:this.bytePointer+1)}readBit(){const t=(this.view.getUint8(this.bytePointer)>>this.bitPointer&1)!=0;return this.skipBits(1),t}readBits(i){let t=0;for(let n=0;n<i;n++)t|=(this.readBit()?1:0)<<n;return t}writeBit(i){let t=this.view.getUint8(this.bytePointer);i?t|=1<<this.bitPointer:t&=1<<this.bitPointer^255,this.view.setUint8(this.bytePointer,t),this.skipBits(1)}writeBits(i,t){for(let n=0;n<i;n++)this.writeBit((t&1)!=0),t>>=1}}const N=64;function qt(e,i){return()=>{e|=0,e=e+2654435769|0;let t=e^e>>>16;t=Math.imul(t,569420461),t=t^t>>>15,t=Math.imul(t,1935289751);const n=(t=t^t>>>15)>>>0;return i?n/4294967296:n}}function we(e,i,t,n){return e^=e<<13|e>>>17,e=e*2158630691+3333583613&4294967295,e^=i,e^=e<<13|e>>>17,e=e*2158630691+3333583613&4294967295,e^=t,e^=e<<13|e>>>17,e=e*2158630691+3333583613&4294967295,e^=n,e^=e<<16|e>>>15,e=e*2158630691+3333583613&4294967295,(e>>>0)/4294967295}function dl(e,i){i*=e.reduce((t,n)=>t+n,0);for(let t=0;t<e.length;t++)if(i-=e[t],i<=0)return t;throw new Error("Invalid weights")}function ul(e,i,t,n){let a=[];for(let o=Math.floor(i)-1;o<Math.ceil(i)+1;o++)for(let h=Math.floor(t)-1;h<Math.ceil(t)+1;h++)a.push({x:o+we(e,o,h,0)-.5,y:h+we(e,o,h,1)-.5,type:dl(n,we(e,o,h,2))});let r=1/0,s=-1;for(const o of a){const h=Math.sqrt((o.x-i)**2+(o.y-t)**2);h<r&&(r=h,s=o.type)}if(s==-1)throw new Error("Voronoi noise error.");return s}function ji(e,i,t){function n(c,b,E){return(b-c)*((E*(E*6-15)+10)*E*E*E)+c}const a=(c,b)=>{const E=we(e,c,b,0);return{x:Math.cos(E),y:Math.sin(E)}},r=(c,b,E,v)=>{const x=a(c,b),A=E-c,g=v-b;return A*x.x+g*x.y},s=Math.floor(i),o=s+1,h=Math.floor(t),l=h+1,f=i-s,p=t-h;return n(n(r(s,h,i,t),r(o,h,i,t),f),n(r(s,l,i,t),r(o,l,i,t),f),p)}class bl{constructor(i,t){R(this,"textures");R(this,"src");R(this,"img");this.src=i,this.img=document.createElement("img"),this.img.src=this.src,this.textures=t}awaitLoad(){return new Promise((i,t)=>{if(this.img.naturalWidth!==0)return i();const n=()=>{this.img.removeEventListener("load",n),this.img.removeEventListener("error",a),i()},a=()=>{this.img.removeEventListener("load",n),this.img.removeEventListener("error",a),t()};this.img.addEventListener("load",n),this.img.addEventListener("error",a)})}onLoad(i){this.awaitLoad().then(()=>i(this))}draw(i,t,n,a,r,s){const[o,h,l,f]=this.textures[t];i.drawImage(this.img,o,h,l,f,n,a,r,s)}}const C=new bl("/infinite-minesweeper/tileset.png",{null:[0,0,16,16],bomb:[16,0,16,16],explosion:[16,16,16,16],flag:[32,16,16,16],number_0:[48,0,16,16],number_1:[48,16,16,16],number_2:[48,32,16,16],number_3:[48,48,16,16],number_4:[48,64,16,16],number_5:[48,80,16,16],number_6:[48,96,16,16],number_7:[48,112,16,16],number_8:[48,128,16,16],vanilla_tile_covered:[64,0,16,16],vanilla_tile_revealed:[80,0,16,16],chocolate_tile_covered:[64,16,16,16],chocolate_tile_revealed:[80,16,16,16],waffle_tile_covered_light:[64,32,16,16],waffle_tile_revealed_light:[80,32,16,16],waffle_tile_covered_dark:[96,32,16,16],waffle_tile_revealed_dark:[112,32,16,16],stroopwafel_tile_covered_light:[64,48,16,16],stroopwafel_tile_revealed_light:[80,48,16,16],stroopwafel_tile_covered_dark:[96,48,16,16],stroopwafel_tile_revealed_dark:[112,48,16,16]});function gt(e){switch(e){case 0:return"number_0";case 1:return"number_1";case 2:return"number_2";case 3:return"number_3";case 4:return"number_4";case 5:return"number_5";case 6:return"number_6";case 7:return"number_7";case 8:return"number_8";default:return"null"}}class wl{constructor(i,t,n){R(this,"world");R(this,"x");R(this,"y");this.world=i,this.x=t,this.y=n}minesNearby(){let i=0;for(const t of this.searchPattern)i+=this.world.getTile(this.x+t.x,this.y+t.y).numMines();return i}flagsNearby(){let i=0;for(const t of this.searchPattern)i+=this.world.getTile(this.x+t.x,this.y+t.y).numFlags();return i}static load(i,t,n,a){throw new Error("Tile.load needs to be implemented on derived class.")}}class pt extends wl{constructor(t,n,a,r){super(t,n,a);R(this,"isMine");R(this,"state",0);R(this,"searchPattern",[{x:-1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:1,y:-1},{x:0,y:-1},{x:-1,y:-1}]);this.isMine=r}numMines(){return this.isMine?1:0}numFlags(){return this.state==1?1:0}flag(){this.state!=2&&(this.state==0?this.state=1:this.state=0)}reveal(){this.state!=1&&(this.state=2)}}class Jt extends pt{constructor(i,t,n){const a=we(i.tileSeed,t,n,0)>.875;super(i,t,n,a)}render(i){switch(this.state){case 0:{C.draw(i,"vanilla_tile_covered",0,0,1,1);break}case 1:{C.draw(i,"vanilla_tile_covered",0,0,1,1),C.draw(i,"flag",0,0,1,1);break}case 2:{C.draw(i,"vanilla_tile_revealed",0,0,1,1),this.isMine?C.draw(i,"bomb",0,0,1,1):C.draw(i,gt(this.minesNearby()),0,0,1,1);break}}}save(i){i.writeBits(2,this.state)}static load(i,t,n,a){const r=new Jt(i,t,n);switch(a.readBits(2)){case 0:break;case 1:r.flag();break;case 2:r.reveal();break}return r}}class Qt extends pt{constructor(i,t,n){const a=we(i.tileSeed,t,n,0)>.625;super(i,t,n,a)}render(i){switch(this.state){case 0:{C.draw(i,"chocolate_tile_covered",0,0,1,1);break}case 1:{C.draw(i,"chocolate_tile_covered",0,0,1,1),C.draw(i,"flag",0,0,1,1);break}case 2:{C.draw(i,"chocolate_tile_revealed",0,0,1,1),this.isMine?C.draw(i,"bomb",0,0,1,1):C.draw(i,gt(this.minesNearby()),0,0,1,1);break}}}save(i){i.writeBits(2,this.state)}static load(i,t,n,a){const r=new Qt(i,t,n);switch(a.readBits(2)){case 0:break;case 1:r.flag();break;case 2:r.reveal();break}return r}}function Fn(e,i,t,n){const a=Math.floor(t/i),r=Math.floor(n/i),s=(a+r%2)%2==0,o=Math.abs(t%i)+Math.abs(n%i)*i,h=Math.floor(we(e.tileSeed,a,r,0)*i**2),l=s?o!=h:o==h;return{isDark:s,isMine:l}}class ei extends pt{constructor(t,n,a){const{isDark:r,isMine:s}=Fn(t,2,n,a);super(t,n,a,s);R(this,"isDark");this.isDark=r}render(t){switch(this.state){case 0:{C.draw(t,this.isDark?"waffle_tile_covered_dark":"waffle_tile_covered_light",0,0,1,1);break}case 1:{C.draw(t,this.isDark?"waffle_tile_covered_dark":"waffle_tile_covered_light",0,0,1,1),C.draw(t,"flag",0,0,1,1);break}case 2:{C.draw(t,this.isDark?"waffle_tile_revealed_dark":"waffle_tile_revealed_light",0,0,1,1),this.isMine?C.draw(t,"bomb",0,0,1,1):C.draw(t,gt(this.minesNearby()),0,0,1,1);break}}}save(t){t.writeBits(2,this.state)}static load(t,n,a,r){const s=new ei(t,n,a);switch(r.readBits(2)){case 0:break;case 1:s.flag();break;case 2:s.reveal();break}return s}}class ti extends pt{constructor(t,n,a){const{isDark:r,isMine:s}=Fn(t,3,n,a);super(t,n,a,s);R(this,"isDark");this.isDark=r}render(t){switch(this.state){case 0:{C.draw(t,this.isDark?"stroopwafel_tile_covered_dark":"stroopwafel_tile_covered_light",0,0,1,1);break}case 1:{C.draw(t,this.isDark?"stroopwafel_tile_covered_dark":"stroopwafel_tile_covered_light",0,0,1,1),C.draw(t,"flag",0,0,1,1);break}case 2:{C.draw(t,this.isDark?"stroopwafel_tile_revealed_dark":"stroopwafel_tile_revealed_light",0,0,1,1),this.isMine?C.draw(t,"bomb",0,0,1,1):C.draw(t,gt(this.minesNearby()),0,0,1,1);break}}}save(t){t.writeBits(2,this.state)}static load(t,n,a,r){const s=new ti(t,n,a);switch(r.readBits(2)){case 0:break;case 1:s.flag();break;case 2:s.reveal();break}return s}}const gl={type:"collection",weight:1,scale:24,smoothness:.8,biomes:[{type:"collection",weight:5,scale:24,smoothness:.8,biomes:[{type:"biome",weight:3,tile:Jt},{type:"biome",weight:1,tile:Qt}]},{type:"collection",weight:2,scale:64,smoothness:0,biomes:[{type:"biome",weight:1,tile:ei},{type:"biome",weight:2,tile:ti}]}]};function pl(e,i,t,n,a){const r=qt(e,!1),s=ji(r(),i,t)*n,o=ji(r(),i,t)*n;return ul(r(),i+s,t+o,a)}function Hn(e,i,t){const n=qt(e.biomeSeed,!1);let a=gl;for(;a.type=="collection";){const r=pl(n(),i/a.scale,t/a.scale,a.smoothness,a.biomes.map(s=>s.weight));a=a.biomes[r]}return a.tile}function ml(e,i,t){const n=Hn(e,i,t);return new n(e,i,t)}class Pn{constructor(i,t,n){R(this,"world");R(this,"chunkX");R(this,"chunkY");this.world=i,this.chunkX=t,this.chunkY=n}isGenerated(){return this instanceof We}generate(){if(this.isGenerated())throw new Error("Cannot generate an already generated chunk.");console.log(`Generating new chunk: ${this.chunkX}, ${this.chunkY}`);const i=[];for(let t=0;t<N;t++)for(let n=0;n<N;n++){const a=this.world.generateTile(this.chunkX*N+n,this.chunkY*N+t);i.push(a)}return new We(this.world,this.chunkX,this.chunkY,i)}}class We extends Pn{constructor(t,n,a,r){super(t,n,a);R(this,"tiles");if(this.tiles=r,this.tiles.length!=N*N)throw new Error("GeneratedChunk incorrect tiles length.")}getTileAbsolute(t,n){return this.getTile(t-this.chunkX*N,n-this.chunkY*N)}getTile(t,n){return this.tiles[t+n*N]}save(){const t=new Ki(2048);for(const n of this.tiles)n.save(t);return Gi.deflate(t.final()).buffer}static load(t,n,a,r){const s=new Ki(Gi.inflate(r));let o=[];for(let h=0;h<N;h++)for(let l=0;l<N;l++){const f=n*N+l,p=a*N+h,c=Hn(t,f,p).load(t,f,p,s);o.push(c)}return new We(t,n,a,o)}}const Yn="3.7.7",xl=Yn,Ce=typeof Buffer=="function",Wi=typeof TextDecoder=="function"?new TextDecoder:void 0,Vi=typeof TextEncoder=="function"?new TextEncoder:void 0,vl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ue=Array.prototype.slice.call(vl),lt=(e=>{let i={};return e.forEach((t,n)=>i[t]=n),i})(Ue),kl=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,O=String.fromCharCode.bind(String),qi=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),Xn=e=>e.replace(/=/g,"").replace(/[+\/]/g,i=>i=="+"?"-":"_"),$n=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Gn=e=>{let i,t,n,a,r="";const s=e.length%3;for(let o=0;o<e.length;){if((t=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(a=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");i=t<<16|n<<8|a,r+=Ue[i>>18&63]+Ue[i>>12&63]+Ue[i>>6&63]+Ue[i&63]}return s?r.slice(0,s-3)+"===".substring(s):r},ii=typeof btoa=="function"?e=>btoa(e):Ce?e=>Buffer.from(e,"binary").toString("base64"):Gn,Pt=Ce?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let n=0,a=e.length;n<a;n+=4096)t.push(O.apply(null,e.subarray(n,n+4096)));return ii(t.join(""))},ft=(e,i=!1)=>i?Xn(Pt(e)):Pt(e),yl=e=>{if(e.length<2){var i=e.charCodeAt(0);return i<128?e:i<2048?O(192|i>>>6)+O(128|i&63):O(224|i>>>12&15)+O(128|i>>>6&63)+O(128|i&63)}else{var i=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return O(240|i>>>18&7)+O(128|i>>>12&63)+O(128|i>>>6&63)+O(128|i&63)}},El=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Kn=e=>e.replace(El,yl),Ji=Ce?e=>Buffer.from(e,"utf8").toString("base64"):Vi?e=>Pt(Vi.encode(e)):e=>ii(Kn(e)),Se=(e,i=!1)=>i?Xn(Ji(e)):Ji(e),Qi=e=>Se(e,!0),Al=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Sl=e=>{switch(e.length){case 4:var i=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),t=i-65536;return O((t>>>10)+55296)+O((t&1023)+56320);case 3:return O((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return O((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},jn=e=>e.replace(Al,Sl),Wn=e=>{if(e=e.replace(/\s+/g,""),!kl.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(e.length&3));let i,t="",n,a;for(let r=0;r<e.length;)i=lt[e.charAt(r++)]<<18|lt[e.charAt(r++)]<<12|(n=lt[e.charAt(r++)])<<6|(a=lt[e.charAt(r++)]),t+=n===64?O(i>>16&255):a===64?O(i>>16&255,i>>8&255):O(i>>16&255,i>>8&255,i&255);return t},ni=typeof atob=="function"?e=>atob($n(e)):Ce?e=>Buffer.from(e,"base64").toString("binary"):Wn,Vn=Ce?e=>qi(Buffer.from(e,"base64")):e=>qi(ni(e).split("").map(i=>i.charCodeAt(0))),qn=e=>Vn(Jn(e)),Tl=Ce?e=>Buffer.from(e,"base64").toString("utf8"):Wi?e=>Wi.decode(Vn(e)):e=>jn(ni(e)),Jn=e=>$n(e.replace(/[-_]/g,i=>i=="-"?"+":"/")),Yt=e=>Tl(Jn(e)),zl=e=>{if(typeof e!="string")return!1;const i=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(i)||!/[^\s0-9a-zA-Z\-_]/.test(i)},Qn=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),ea=function(){const e=(i,t)=>Object.defineProperty(String.prototype,i,Qn(t));e("fromBase64",function(){return Yt(this)}),e("toBase64",function(i){return Se(this,i)}),e("toBase64URI",function(){return Se(this,!0)}),e("toBase64URL",function(){return Se(this,!0)}),e("toUint8Array",function(){return qn(this)})},ta=function(){const e=(i,t)=>Object.defineProperty(Uint8Array.prototype,i,Qn(t));e("toBase64",function(i){return ft(this,i)}),e("toBase64URI",function(){return ft(this,!0)}),e("toBase64URL",function(){return ft(this,!0)})},Rl=()=>{ea(),ta()},en={version:Yn,VERSION:xl,atob:ni,atobPolyfill:Wn,btoa:ii,btoaPolyfill:Gn,fromBase64:Yt,toBase64:Se,encode:Se,encodeURI:Qi,encodeURL:Qi,utob:Kn,btou:jn,decode:Yt,isValid:zl,fromUint8Array:ft,toUint8Array:qn,extendString:ea,extendUint8Array:ta,extendBuiltins:Rl};function*Dl(e,i){let t=e,n=i,a=1,r=1;for(;;){for(;2*t*a<r;)yield{x:t,y:n},t+=a;for(;2*n*a<r;)yield{x:t,y:n},n+=a;a=-1*a,r+=1}}class dt{constructor(i){R(this,"seed");R(this,"tileSeed");R(this,"biomeSeed");R(this,"chunks",{});this.seed=i;const t=qt(this.seed,!1);this.tileSeed=t(),this.biomeSeed=t()}generateTile(i,t){return ml(this,i,t)}getChunk(i,t){const n=this.chunks[`${i},${t}`];return n||new Pn(this,i,t)}getGeneratedChunk(i,t){const n=this.getChunk(i,t);if(n.isGenerated())return n;const a=n.generate();return this.chunks[`${i},${t}`]=a,a}getTile(i,t){const n=Math.floor(i/N),a=Math.floor(t/N);return this.getGeneratedChunk(n,a).getTileAbsolute(i,t)}flag(i,t){return this.getTile(i,t).flag()}reveal(i,t,n=!0){const a=this.getTile(i,t);if(a.reveal(),a.numMines()>0)return!0;if(a.minesNearby()>0)if(n){let o=!1;if(a.flagsNearby()==a.minesNearby())for(const h of a.searchPattern)this.reveal(a.x+h.x,a.y+h.y,!1)&&(o=!0);return o}else return!1;let r=[],s=[a];for(;s.length>0;){const o=s.pop();r.push(o);for(const h of o.searchPattern){const l=this.getTile(o.x+h.x,o.y+h.y);s.some(f=>f.x==l.x&&f.y==l.y)||r.some(f=>f.x==l.x&&f.y==l.y)||(l.minesNearby()==0?s.push(l):r.push(l))}}return r.forEach(o=>o.reveal()),!1}closest0(i,t){for(const{x:n,y:a}of Dl(i,t)){const r=this.getTile(n,a);if(r.numMines()==0&&r.minesNearby()==0)return{x:n,y:a}}throw new Error("This error should never happen, it's just here to make TypeScript happy.")}save(){const i={seed:this.seed,chunks:{}};for(const t in this.chunks){const n=t,r=this.chunks[n].save();i.chunks[n]=en.fromUint8Array(new Uint8Array(r))}return i}static load(i){const t=new dt(i.seed);for(const n in i.chunks){const a=n,r=i.chunks[a],s=en.toUint8Array(r).buffer,[o,h,l]=a.match(/^(-?\d+),(-?\d+)$/),[f,p]=[parseInt(h),parseInt(l)];t.chunks[a]=We.load(t,f,p,s)}return t}}const Zl=(e,i)=>{const t=new ResizeObserver(()=>{i(e.clientWidth,e.clientHeight)});return t.observe(e),{destroy(){t.unobserve(e),t.disconnect()}}};function tn(e){let i,t,n=e[0].seed+"",a,r,s;return{c(){i=Y("span"),t=G("Seed: "),a=G(n),r=q(),s=Y("br")},l(o){i=X(o,"SPAN",{});var h=ae(i);t=K(h,"Seed: "),a=K(h,n),r=J(h),h.forEach(M),s=X(o,"BR",{})},m(o,h){V(o,i,h),Z(i,t),Z(i,a),Z(i,r),V(o,s,h)},p(o,h){h&1&&n!==(n=o[0].seed+"")&&_e(a,n)},d(o){o&&(M(i),M(s))}}}function nn(e){let i,t,n=e[7].x+"",a,r,s=e[7].y+"",o,h,l,f,p,d,c=Math.floor(e[7].x/N)+"",b,E,v=Math.floor(e[7].y/N)+"",x,A;return{c(){i=Y("span"),t=G("Tile: "),a=G(n),r=q(),o=G(s),h=q(),l=Y("br"),f=q(),p=Y("span"),d=G("Chunk: "),b=G(c),E=q(),x=G(v),A=q()},l(g){i=X(g,"SPAN",{});var _=ae(i);t=K(_,"Tile: "),a=K(_,n),r=J(_),o=K(_,s),_.forEach(M),h=J(g),l=X(g,"BR",{}),f=J(g),p=X(g,"SPAN",{});var m=ae(p);d=K(m,"Chunk: "),b=K(m,c),E=J(m),x=K(m,v),m.forEach(M),A=J(g)},m(g,_){V(g,i,_),Z(i,t),Z(i,a),Z(i,r),Z(i,o),V(g,h,_),V(g,l,_),V(g,f,_),V(g,p,_),Z(p,d),Z(p,b),Z(p,E),Z(p,x),V(g,A,_)},p(g,_){_&128&&n!==(n=g[7].x+"")&&_e(a,n),_&128&&s!==(s=g[7].y+"")&&_e(o,s),_&128&&c!==(c=Math.floor(g[7].x/N)+"")&&_e(b,c),_&128&&v!==(v=Math.floor(g[7].y/N)+"")&&_e(x,v)},d(g){g&&(M(i),M(h),M(l),M(f),M(p),M(A))}}}function an(e){let i=Math.round(e[6]*10)/10+"",t,n;return{c(){t=G(i),n=G("ms")},l(a){t=K(a,i),n=K(a,"ms")},m(a,r){V(a,t,r),V(a,n,r)},p(a,r){r&64&&i!==(i=Math.round(a[6]*10)/10+"")&&_e(t,i)},d(a){a&&(M(t),M(n))}}}function Cl(e){let i,t,n,a,r,s,o,h,l=`Left Click: Reveal tile<br/>
                    Right Click: Flag tile<br/>
                    Middle Click: Drag view<br/>
                    Scroll Wheel: Zoom view<br/>`,f,p,d,c,b,E,v,x,A,g,_=e[0]&&tn(e),m=e[7]&&nn(e),w=e[6]!==null&&an(e);return{c(){i=Y("div"),t=Y("canvas"),a=q(),r=Y("div"),s=Y("div"),o=Y("div"),h=Y("span"),h.innerHTML=l,f=q(),_&&_.c(),p=q(),m&&m.c(),d=Y("br"),c=q(),b=Y("span"),E=G("Frame "),v=G(e[5]),x=q(),w&&w.c(),this.h()},l(u){i=X(u,"DIV",{class:!0});var S=ae(i);t=X(S,"CANVAS",{class:!0}),ae(t).forEach(M),a=J(S),r=X(S,"DIV",{class:!0});var T=ae(r);s=X(T,"DIV",{class:!0});var k=ae(s);o=X(k,"DIV",{class:!0});var y=ae(o);h=X(y,"SPAN",{"data-svelte-h":!0}),da(h)!=="svelte-kehkvw"&&(h.innerHTML=l),f=J(y),_&&_.l(y),p=J(y),m&&m.l(y),d=X(y,"BR",{}),c=J(y),b=X(y,"SPAN",{});var H=ae(b);E=K(H,"Frame "),v=K(H,e[5]),x=J(H),w&&w.l(H),H.forEach(M),y.forEach(M),k.forEach(M),T.forEach(M),S.forEach(M),this.h()},h(){Ie(t,"class","w-full h-full col-start-1 col-end-1 row-start-1 row-end-1"),Ie(o,"class","text-white font-bold"),Ie(s,"class","float-right pointer-events-auto m-4 p-4 bg-zinc-800 bg-opacity-70 outline outline-zinc-600 rounded-lg"),Ie(r,"class","w-full h-full col-start-1 col-end-1 row-start-1 row-end-1 pointer-events-none"),Ie(i,"class","w-screen h-screen grid grid-cols-1 grid-rows-1")},m(u,S){V(u,i,S),Z(i,t),e[10](t),Z(i,a),Z(i,r),Z(r,s),Z(s,o),Z(o,h),Z(o,f),_&&_.m(o,null),Z(o,p),m&&m.m(o,null),Z(o,d),Z(o,c),Z(o,b),Z(b,E),Z(b,v),Z(b,x),w&&w.m(b,null),A||(g=[ke(window,"unload",e[9]),ra(n=Zl.call(null,t,e[11])),ke(t,"mousedown",e[12]),ke(t,"mouseup",e[13]),ke(t,"mousemove",e[14]),ke(t,"wheel",e[15],{passive:!0}),ke(t,"contextmenu",Il)],A=!0)},p(u,[S]){n&&oa(n.update)&&S&158&&n.update.call(null,u[11]),u[0]?_?_.p(u,S):(_=tn(u),_.c(),_.m(o,p)):_&&(_.d(1),_=null),u[7]?m?m.p(u,S):(m=nn(u),m.c(),m.m(o,d)):m&&(m.d(1),m=null),S&32&&_e(v,u[5]),u[6]!==null?w?w.p(u,S):(w=an(u),w.c(),w.m(b,null)):w&&(w.d(1),w=null)},i:ri,o:ri,d(u){u&&M(i),e[10](null),_&&_.d(),m&&m.d(),w&&w.d(),A=!1,la(g)}}}const Il=e=>{e.preventDefault()};function Ml(e,i,t){let n,a=!0,r,s;function o(){const w=localStorage.getItem("save");if(w){console.log("Loaded saved world");const u=JSON.parse(w);t(0,r=dt.load(u))}else{console.log("Loaded new world"),localStorage.setItem("save","PLACEHOLDER"),t(0,r=new dt(Math.floor(Math.random()*4294967295)));const u=r.closest0(0,0);r.reveal(u.x,u.y)}t(3,s=new ua(r,n)),t(2,a=!0)}function h(){localStorage.getItem("save")!==null&&(console.log("Save world"),localStorage.setItem("save",JSON.stringify(r.save())))}let l=!1,f=-1,p=0,d=null;const c=()=>{if(cancelAnimationFrame(f),f=requestAnimationFrame(c),l){t(4,l=!1),t(5,p++,p);const w=performance.now();s.render(),t(6,d=performance.now()-w)}};let b=null;sa(()=>{o(),C.onLoad(()=>{t(4,l=!0)}),c()}),fa(()=>{cancelAnimationFrame(f),h()});const E=()=>{h()};function v(w){ha[w?"unshift":"push"](()=>{n=w,t(1,n)})}const x=(w,u)=>{t(1,n.width=w,n),t(1,n.height=u,n),s.cameraScale(1),t(7,b=null),a&&(s.cameraTranslate(n.width/2,n.height/2),t(2,a=!1)),t(4,l=!0)},A=w=>{if(document.pointerLockElement!=n){if(w.button==1)n.requestPointerLock(),w.preventDefault();else if(w.button==0){w.preventDefault();const u=s.cameraPos(w.offsetX,w.offsetY);r.reveal(u.x,u.y),t(4,l=!0)}else if(w.button==2){w.preventDefault();const u=s.cameraPos(w.offsetX,w.offsetY);r.flag(u.x,u.y),t(4,l=!0)}}},g=w=>{document.pointerLockElement==n&&w.button==1&&document.exitPointerLock()},_=w=>{t(7,b=s.cameraPos(w.offsetX,w.offsetY)),document.pointerLockElement==n&&(s.cameraTranslate(w.movementX,w.movementY),t(4,l=!0))},m=w=>{const u=w.deltaY>0?.9:1.1;s.cameraZoom!=s.cameraScale(u)&&(t(7,b=s.cameraPos(w.offsetX,w.offsetY)),t(4,l=!0))};return e.$$.update=()=>{e.$$.dirty&1&&r&&console.log(r)},[r,n,a,s,l,p,d,b,h,E,v,x,A,g,_,m]}class Ol extends ca{constructor(i){super(),_a(this,i,Ml,Cl,aa,{})}}export{Ol as component};
